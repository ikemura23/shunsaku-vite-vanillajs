// AIã‚¹ã‚³ã‚¢ãƒªãƒ³ã‚°æ©Ÿèƒ½ï¼ˆãƒ¢ãƒƒã‚¯å®Ÿè£…ï¼‰

import { scoreUtils, debugUtils } from './utils.js'

// ã‚¹ã‚³ã‚¢ãƒªãƒ³ã‚°é …ç›®ã®å®šç¾©
const SCORING_ITEMS = {
  power: { name: 'ã‚¹ã‚¤ãƒ³ã‚°ã®åŠ›å¼·ã•', weight: 20, icon: 'ğŸ’ª' },
  stability: { name: 'å§¿å‹¢ã®å®‰å®šæ€§', weight: 25, icon: 'âš–ï¸' },
  beauty: { name: 'ãƒ•ã‚©ãƒ¼ãƒ ã®ç¾ã—ã•', weight: 15, icon: 'âœ¨' },
  growth: { name: 'æˆé•·æ€§', weight: 20, icon: 'ğŸ“ˆ' },
  spirit: { name: 'è¡¨æƒ…ãƒ»ã‚„ã‚‹æ°—', weight: 20, icon: 'ğŸ˜¤' }
}

// AIåˆ†æã‚³ãƒ¡ãƒ³ãƒˆãƒ‘ã‚¿ãƒ¼ãƒ³
const ANALYSIS_COMMENTS = [
  {
    scoreRange: [90, 100],
    comments: [
      'ã€æŠ€è¡“åˆ†æã€‘ã‚¢ãƒ‰ãƒ¬ã‚¹æ™‚ã®å§¿å‹¢ãŒéå¸¸ã«å®‰å®šã—ã¦ãŠã‚Šã€è…°ã®å›è»¢ã¨è‚©ã®ãƒ©ã‚¤ãƒ³ãŒç†æƒ³çš„ãªè§’åº¦ã‚’ä¿ã£ã¦ã„ã¾ã™ã€‚ãƒãƒƒã‚¯ã‚¹ã‚¤ãƒ³ã‚°æ™‚ã®å·¦è…•ã®ä¼¸ã³ãŒç¾ã—ãã€ãƒˆãƒƒãƒ—ã§ã®ã‚¯ãƒ©ãƒ–ãƒ•ã‚§ãƒ¼ã‚¹ã®å‘ãã‚‚å®Œç’§ã§ã™ã€‚ãƒ€ã‚¦ãƒ³ã‚¹ã‚¤ãƒ³ã‚°æ™‚ã®ä½“é‡ç§»å‹•ãŒæ»‘ã‚‰ã‹ã§ã€ã‚¤ãƒ³ãƒ‘ã‚¯ãƒˆç¬é–“ã®æ‰‹é¦–ã®è¿”ã—ãŒåŠ›å¼·ã•ã‚’ç‰©èªã£ã¦ã„ã¾ã™ã€‚\n\nã€Goodã€‘ãƒªãƒ¼ãƒ€ãƒ¼ã‚·ãƒƒãƒ—ã«ç›¸å¿œã—ã„å ‚ã€…ã¨ã—ãŸã‚¹ã‚¿ãƒ³ã‚¹ã€çµŒå–¶è€…ã¨ã—ã¦ã®æ±ºæ–­åŠ›ãŒã‚¹ã‚¤ãƒ³ã‚°ã«è¡¨ã‚Œã¦ã„ã¾ã™ã€‚\nã€Nextã€‘ã“ã®å®Œæˆåº¦ã‚’ç¶­æŒã—ã€æ¥å¹´ã¯æ›´ãªã‚‹é£›è·é›¢å‘ä¸Šã‚’ç›®æŒ‡ã—ã¾ã—ã‚‡ã†ã€‚',
      'ã€æŠ€è¡“åˆ†æã€‘ãƒ†ãƒ¼ã‚¯ãƒãƒƒã‚¯æ™‚ã®è»¸ã®å®‰å®šæ€§ãŒç´ æ™´ã‚‰ã—ãã€ç‰¹ã«å³è†ã®è§’åº¦ã‚­ãƒ¼ãƒ—ãŒç§€é€¸ã§ã™ã€‚ãƒãƒ¼ãƒ•ã‚¦ã‚§ã‚¤ãƒ€ã‚¦ãƒ³ã§ã®ã‚¯ãƒ©ãƒ–ã®è»Œé“ãŒç†æƒ³çš„ãªã‚¤ãƒ³ã‚µã‚¤ãƒ‰ã‚¢ã‚¦ãƒˆã‚’æã„ã¦ãŠã‚Šã€ãƒ•ã‚©ãƒ­ãƒ¼ã‚¹ãƒ«ãƒ¼ã¾ã§ã®ä¸€é€£ã®å‹•ä½œã«ç„¡é§„ãŒã‚ã‚Šã¾ã›ã‚“ã€‚ã‚°ãƒªãƒƒãƒ—ã®æ¡ã‚Šæ–¹ã‚‚é©åˆ‡ã§ã€æ‰‹é¦–ã®è§’åº¦ãŒåŠ›å¼·ã„ã‚¤ãƒ³ãƒ‘ã‚¯ãƒˆã‚’ç”Ÿã¿å‡ºã—ã¦ã„ã¾ã™ã€‚\n\nã€Goodã€‘çµŒå–¶è€…ã‚‰ã—ã„é›†ä¸­åŠ›ã¨ç²¾ç¥çš„ãªå®‰å®šæ„ŸãŒãƒ•ã‚©ãƒ¼ãƒ å…¨ä½“ã«ç¾ã‚Œã¦ã„ã¾ã™ã€‚\nã€Nextã€‘æ—¢ã«é«˜ã„å®Œæˆåº¦ã§ã™ãŒã€ã•ã‚‰ãªã‚‹é£›è·é›¢ã‚¢ãƒƒãƒ—ã®ãŸã‚ä½“å¹¹å¼·åŒ–ã‚’ãŠå‹§ã‚ã—ã¾ã™ã€‚',
      'ã€æŠ€è¡“åˆ†æã€‘å®Œç’§ãªã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã‹ã‚‰å§‹ã¾ã‚Šã€ãƒãƒƒã‚¯ã‚¹ã‚¤ãƒ³ã‚°æ™‚ã®è‚©ç”²éª¨ã®å‹•ããŒç§€é€¸ã§ã™ã€‚ãƒˆãƒƒãƒ—ã§ã®å·¦æ‰‹é¦–ã®è§’åº¦ãŒç†æƒ³çš„ã§ã€åˆ‡ã‚Šè¿”ã—æ™‚ã®ä¸‹åŠèº«ãƒªãƒ¼ãƒ‰ã‚‚æ•™ç§‘æ›¸é€šã‚Šã§ã™ã€‚ã‚¤ãƒ³ãƒ‘ã‚¯ãƒˆæ™‚ã®ã‚¯ãƒ©ãƒ–ãƒ•ã‚§ãƒ¼ã‚¹ã®å‘ãã¨ãƒœãƒ¼ãƒ«ã¸ã®ã‚¢ã‚¿ãƒƒã‚¯è§’åº¦ãŒç´ æ™´ã‚‰ã—ãã€ãƒ•ã‚£ãƒ‹ãƒƒã‚·ãƒ¥ã¾ã§ã®æµã‚ŒãŒä¸€è²«ã—ã¦ã„ã¾ã™ã€‚\n\nã€Goodã€‘çµŒå–¶è€…ã¨ã—ã¦ã®å¨å³ã¨è‡ªä¿¡ãŒã‚¹ã‚¤ãƒ³ã‚°å…¨ä½“ã«æ¼‚ã£ã¦ã„ã¾ã™ã€‚\nã€Nextã€‘ã“ã®æŠ€è¡“ãƒ¬ãƒ™ãƒ«ãªã‚‰ã€æˆ¦ç•¥çš„ãªã‚³ãƒ¼ã‚¹ãƒãƒã‚¸ãƒ¡ãƒ³ãƒˆã‚‚å­¦ã°ã‚Œã‚‹ã¨è‰¯ã„ã§ã—ã‚‡ã†ã€‚'
    ]
  },
  {
    scoreRange: [80, 89],
    comments: [
      'ã€æŠ€è¡“åˆ†æã€‘ã‚¢ãƒ‰ãƒ¬ã‚¹æ™‚ã®ãƒœãƒ¼ãƒ«ã¨ã®è·é›¢æ„ŸãŒè‰¯å¥½ã§ã€ã‚°ãƒªãƒƒãƒ—ã‚¨ãƒ³ãƒ‰ã®å‘ãã‚‚é©åˆ‡ã§ã™ã€‚ãƒãƒƒã‚¯ã‚¹ã‚¤ãƒ³ã‚°æ™‚ã®è‚©ã®å›è»¢è§’åº¦ã¯ç†æƒ³ã«è¿‘ãã€ç‰¹ã«å·¦è‚©ã®å…¥ã‚Šæ–¹ãŒå°è±¡çš„ã§ã™ã€‚ã‚¤ãƒ³ãƒ‘ã‚¯ãƒˆæ™‚ã®é ­ã®ä½ç½®ãŒå®‰å®šã—ã¦ãŠã‚Šã€ãƒ•ã‚£ãƒ‹ãƒƒã‚·ãƒ¥ã§ã®ãƒãƒ©ãƒ³ã‚¹ã‚‚è‰¯å¥½ã§ã™ã€‚ãŸã ã—ã€ãƒ€ã‚¦ãƒ³ã‚¹ã‚¤ãƒ³ã‚°åˆæœŸã§ã‚„ã‚„æ€¥æ¿€ãªå‹•ããŒè¦‹ã‚‰ã‚Œã¾ã™ã€‚\n\nã€Goodã€‘çµŒå–¶æ‰‹è…•ã¨åŒæ§˜ã®å®‰å®šæ„Ÿã®ã‚ã‚‹ã‚¹ã‚¤ãƒ³ã‚°ãƒªã‚ºãƒ ãŒè©•ä¾¡ã§ãã¾ã™ã€‚\nã€Nextã€‘åˆ‡ã‚Šè¿”ã—æ™‚ã®é–“ï¼ˆã‚¿ãƒ¡ï¼‰ã‚’ã‚‚ã†å°‘ã—æ„è­˜ã™ã‚‹ã¨ã€ã‚ˆã‚Šæ»‘ã‚‰ã‹ãªã‚¹ã‚¤ãƒ³ã‚°ã«ãªã‚‹ã§ã—ã‚‡ã†ã€‚',
      'ã€æŠ€è¡“åˆ†æã€‘ã‚¹ã‚¿ãƒ³ã‚¹å¹…ãŒé©åˆ‡ã§ã€è¶³ã®è¸ã‚“å¼µã‚ŠãŒåŠ¹ã„ã¦ã„ã¾ã™ã€‚ãƒãƒƒã‚¯ã‚¹ã‚¤ãƒ³ã‚°æ™‚ã®ã‚³ãƒƒã‚¯ã®ä½¿ã„æ–¹ã‚‚è‰¯ãã€ãƒˆãƒƒãƒ—ã§ã®å·¦è…•ã®ä½ç½®ã¯åˆæ ¼ãƒ¬ãƒ™ãƒ«ã§ã™ã€‚ãƒ€ã‚¦ãƒ³ã‚¹ã‚¤ãƒ³ã‚°æ™‚ã®è…°ã®å›è»¢ã‚¹ãƒ”ãƒ¼ãƒ‰ãŒé©åº¦ã§ã€ãƒ•ã‚©ãƒ­ãƒ¼ã‚¹ãƒ«ãƒ¼ã§ã®å³è‚©ã®æŠœã‘ã‚‚è‡ªç„¶ã§ã™ã€‚ã‚ãšã‹ã«ã‚¢ã‚¦ãƒˆã‚µã‚¤ãƒ‰ã‚¤ãƒ³è»Œé“ã®å‚¾å‘ãŒè¦‹ã‚‰ã‚Œã¾ã™ãŒã€å…¨ä½“çš„ã«ã¯å®‰å®šã—ãŸã‚¹ã‚¤ãƒ³ã‚°ã§ã™ã€‚\n\nã€Goodã€‘å†·é™ãªåˆ¤æ–­åŠ›ãŒã‚¹ã‚¤ãƒ³ã‚°ã®å®‰å®šæ€§ã«ç¹‹ãŒã£ã¦ã„ã¾ã™ã€‚\nã€Nextã€‘ã‚¯ãƒ©ãƒ–ãƒ•ã‚§ãƒ¼ã‚¹ã®å‘ãã‚’æ„è­˜ã—ã¦ã€ã‚ˆã‚Šã‚¹ãƒˆãƒ¬ãƒ¼ãƒˆå¼¾é“ã‚’ç›®æŒ‡ã—ã¾ã—ã‚‡ã†ã€‚',
      'ã€æŠ€è¡“åˆ†æã€‘å‰å‚¾å§¿å‹¢ã®ç¶­æŒãŒè‰¯å¥½ã§ã€ãƒãƒƒã‚¯ã‚¹ã‚¤ãƒ³ã‚°æ™‚ã®é‡å¿ƒç§»å‹•ã‚‚ã‚¹ãƒ ãƒ¼ã‚ºã§ã™ã€‚ãƒˆãƒƒãƒ—ã§ã®ã‚¯ãƒ©ãƒ–ã®ä½ç½®ã¯é©åˆ‡ã§ã€ãƒ€ã‚¦ãƒ³ã‚¹ã‚¤ãƒ³ã‚°æ™‚ã®å·¦ã‚µã‚¤ãƒ‰ã®ç²˜ã‚ŠãŒåŠ¹ã„ã¦ã„ã¾ã™ã€‚ã‚¤ãƒ³ãƒ‘ã‚¯ãƒˆæ™‚ã®ä¸¡è…•ã®ä¼¸ã³ã‚‚è‰¯ãã€ãƒ•ã‚©ãƒ­ãƒ¼ã‚¹ãƒ«ãƒ¼ã§ã®ä½“ã®å›è»¢ã‚‚è‡ªç„¶ã§ã™ã€‚å³è¶³ã®è¹´ã‚ŠãŒã‚‚ã†å°‘ã—å¼·ã„ã¨ã‚ˆã‚Šè‰¯ã„ã§ã—ã‚‡ã†ã€‚\n\nã€Goodã€‘çµ„ç¹”é‹å–¶ã¨åŒã˜ãã€ãƒãƒ©ãƒ³ã‚¹æ„Ÿè¦šã«å„ªã‚ŒãŸã‚¹ã‚¤ãƒ³ã‚°ã§ã™ã€‚\nã€Nextã€‘ã‚¤ãƒ³ãƒ‘ã‚¯ãƒˆå¾Œã®å³è¶³ã®ä½¿ã„æ–¹ã‚’æ„è­˜ã™ã‚‹ã¨ã€ã•ã‚‰ã«åŠ›å¼·ããªã‚Šã¾ã™ã€‚'
    ]
  },
  {
    scoreRange: [70, 79],
    comments: [
      'ã€æŠ€è¡“åˆ†æã€‘ã‚¢ãƒ‰ãƒ¬ã‚¹æ™‚ã®å‰å‚¾è§’åº¦ã¯é©åˆ‡ã§ã™ãŒã€ã‚°ãƒªãƒƒãƒ—ãŒã‚„ã‚„å¼·ã‚ã§ã™ã€‚ãƒãƒƒã‚¯ã‚¹ã‚¤ãƒ³ã‚°æ™‚ã®è…°ã®å›è»¢ã¯ã‚¹ãƒ ãƒ¼ã‚ºã§ã™ãŒã€å·¦è…•ã«ã‚ãšã‹ãªæ›²ãŒã‚ŠãŒè¦‹ã‚‰ã‚Œã¾ã™ã€‚ãƒ€ã‚¦ãƒ³ã‚¹ã‚¤ãƒ³ã‚°æ™‚ã®ä½“é‡ç§»å‹•ã®ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã¯è‰¯å¥½ã§ã™ãŒã€ã‚¤ãƒ³ãƒ‘ã‚¯ãƒˆæ™‚ã«è‹¥å¹²ã®ãƒ–ãƒ¬ãŒç¢ºèªã•ã‚Œã¾ã™ã€‚ãƒ•ã‚©ãƒ­ãƒ¼ã‚¹ãƒ«ãƒ¼ã¯åŠ›å¼·ãã€çµŒå–¶è€…ã‚‰ã—ã„æ„å¿—ã®å¼·ã•ã‚’æ„Ÿã˜ã¾ã™ã€‚\n\nã€Goodã€‘å›°é›£ã«ç«‹ã¡å‘ã‹ã†å§¿å‹¢ãŒã‚¹ã‚¤ãƒ³ã‚°ã‹ã‚‰ã‚‚ä¼ã‚ã£ã¦ãã¾ã™ã€‚\nã€Nextã€‘ã‚¢ãƒ‰ãƒ¬ã‚¹æ™‚ã®ã‚°ãƒªãƒƒãƒ—ãƒ—ãƒ¬ãƒƒã‚·ãƒ£ãƒ¼ã‚’å°‘ã—ç·©ã‚ã‚‹ã¨ã€ã‚ˆã‚Šè‡ªç„¶ãªã‚¹ã‚¤ãƒ³ã‚°ã«ãªã‚Šã¾ã™ã€‚',
      'ã€æŠ€è¡“åˆ†æã€‘ãƒ†ãƒ¼ã‚¯ãƒãƒƒã‚¯æ™‚ã®è‚©ã¨è…°ã®é€£å‹•ã¯è‰¯å¥½ã§ã™ãŒã€ã‚¯ãƒ©ãƒ–ãƒ˜ãƒƒãƒ‰ã®è»Œé“ãŒã‚„ã‚„å¤–å´ã«ä¸ŠãŒã‚‹å‚¾å‘ãŒã‚ã‚Šã¾ã™ã€‚ãƒˆãƒƒãƒ—ã§ã®ã‚·ãƒ£ãƒ•ãƒˆã‚¯ãƒ­ã‚¹ã¯è»½å¾®ã§è¨±å®¹ç¯„å›²å†…ã§ã™ã€‚ãƒ€ã‚¦ãƒ³ã‚¹ã‚¤ãƒ³ã‚°æ™‚ã®å·¦ã‚µã‚¤ãƒ‰ã®å£ã¯ä½œã‚Œã¦ã„ã¾ã™ãŒã€å³æ‰‹ã®ä½¿ã„æ–¹ã«ã‚‚ã†å°‘ã—ä½™è£•ãŒã‚ã‚‹ã¨è‰¯ã„ã§ã—ã‚‡ã†ã€‚å…¨ä½“çš„ã«ãƒãƒ©ãƒ³ã‚¹ã®å–ã‚ŒãŸã‚¹ã‚¤ãƒ³ã‚°ã§ã™ã€‚\n\nã€Goodã€‘çµ„ç¹”ã‚’ã¾ã¨ã‚ã‚‹åŠ›å¼·ã•ãŒã‚¹ã‚¤ãƒ³ã‚°ã«ã‚‚è¡¨ã‚Œã¦ã„ã¾ã™ã€‚\nã€Nextã€‘ãƒãƒƒã‚¯ã‚¹ã‚¤ãƒ³ã‚°æ™‚ã®ã‚¯ãƒ©ãƒ–ã®ä¸Šã’æ–¹ã‚’å°‘ã—å†…å´ã«æ„è­˜ã—ã¦ã¿ã¦ãã ã•ã„ã€‚',
      'ã€æŠ€è¡“åˆ†æã€‘ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—æ™‚ã®è†ã®è§’åº¦ãŒè‰¯å¥½ã§ã€ã‚¢ãƒ‰ãƒ¬ã‚¹æ™‚ã®é‡å¿ƒé…åˆ†ã‚‚é©åˆ‡ã§ã™ã€‚ãƒãƒƒã‚¯ã‚¹ã‚¤ãƒ³ã‚°æ™‚ã®ä¸Šä½“ã®æ»è»¢ã¯ååˆ†ã§ã™ãŒã€å·¦æ‰‹é¦–ã®è§’åº¦ã«ã‚„ã‚„æ”¹å–„ã®ä½™åœ°ãŒã‚ã‚Šã¾ã™ã€‚ãƒ€ã‚¦ãƒ³ã‚¹ã‚¤ãƒ³ã‚°æ™‚ã®è…°ã®åˆ‡ã‚Œã¯è‰¯ã„ã§ã™ãŒã€ã‚¤ãƒ³ãƒ‘ã‚¯ãƒˆæ™‚ã®å³è‚˜ã®ä½ç½®ãŒã‚‚ã†å°‘ã—ä½“ã«è¿‘ã„ã¨ç†æƒ³çš„ã§ã™ã€‚\n\nã€Goodã€‘ç¶™ç¶šçš„ãªåŠªåŠ›ã¨å‘ä¸Šå¿ƒãŒã‚¹ã‚¤ãƒ³ã‚°ã«ç¾ã‚Œã¦ã„ã¾ã™ã€‚\nã€Nextã€‘å·¦æ‰‹é¦–ã®è§’åº¦ã‚’æ„è­˜ã—ã¦ç·´ç¿’ã™ã‚‹ã¨ã€ã‚ˆã‚Šå®‰å®šã—ãŸã‚¤ãƒ³ãƒ‘ã‚¯ãƒˆãŒå¾—ã‚‰ã‚Œã¾ã™ã€‚'
    ]
  },
  {
    scoreRange: [60, 69],
    comments: [
      'ã€æŠ€è¡“åˆ†æã€‘ã‚¹ã‚¿ãƒ³ã‚¹å¹…ã¯ã»ã¼é©åˆ‡ã§ã™ãŒã€ãƒœãƒ¼ãƒ«ãƒã‚¸ã‚·ãƒ§ãƒ³ãŒè‹¥å¹²å·¦å¯„ã‚Šã§ã™ã€‚ãƒãƒƒã‚¯ã‚¹ã‚¤ãƒ³ã‚°æ™‚ã®ä½“é‡ç§»å‹•ã¯è¦‹ã‚‰ã‚Œã¾ã™ãŒã€ãƒˆãƒƒãƒ—ã§ã®å·¦è…•ã®è§’åº¦ã«æ”¹å–„ã®ä½™åœ°ãŒã‚ã‚Šã¾ã™ã€‚ãƒ€ã‚¦ãƒ³ã‚¹ã‚¤ãƒ³ã‚°æ™‚ã®ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã¯æ‚ªãã‚ã‚Šã¾ã›ã‚“ãŒã€ã‚¤ãƒ³ãƒ‘ã‚¯ãƒˆæ™‚ã®ä½“ã®é–‹ããŒã‚„ã‚„æ—©ã‚ã§ã™ã€‚ãƒ•ã‚£ãƒ‹ãƒƒã‚·ãƒ¥ã§ã®ãƒãƒ©ãƒ³ã‚¹ã¯ä¿ãŸã‚Œã¦ãŠã‚Šã€åŸºæœ¬çš„ãªãƒãƒ†ãƒ³ã‚·ãƒ£ãƒ«ã‚’æ„Ÿã˜ã¾ã™ã€‚\n\nã€Goodã€‘æ–°ã—ã„ã“ã¨ã«æŒ‘æˆ¦ã™ã‚‹ç©æ¥µæ€§ãŒã‚¹ã‚¤ãƒ³ã‚°ã‹ã‚‰ã‚‚ä¼ã‚ã£ã¦ãã¾ã™ã€‚\nã€Nextã€‘ã‚¢ãƒ‰ãƒ¬ã‚¹æ™‚ã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã‚’ã‚‚ã†å°‘ã—ä¸å¯§ã«è¡Œã†ã¨ã€ã‚¹ã‚¤ãƒ³ã‚°å…¨ä½“ãŒå‘ä¸Šã—ã¾ã™ã€‚',
      'ã€æŠ€è¡“åˆ†æã€‘ã‚°ãƒªãƒƒãƒ—ã®æ¡ã‚Šæ–¹ã¯åŸºæœ¬ã«æ²¿ã£ã¦ã„ã¾ã™ãŒã€å·¦æ‰‹ã®è¦ªæŒ‡ã®ä½ç½®ã«èª¿æ•´ã®ä½™åœ°ãŒã‚ã‚Šã¾ã™ã€‚ãƒãƒƒã‚¯ã‚¹ã‚¤ãƒ³ã‚°æ™‚ã®è‚©ã®å›è»¢è§’åº¦ã¯ååˆ†ã§ã™ãŒã€è…°ã®å›è»¢ãŒã‚„ã‚„ä¸è¶³æ°—å‘³ã§ã™ã€‚ãƒ€ã‚¦ãƒ³ã‚¹ã‚¤ãƒ³ã‚°æ™‚ã®è»Œé“ã¯æ¦‚ã­è‰¯å¥½ã§ã™ãŒã€ãƒ•ã‚©ãƒ­ãƒ¼ã‚¹ãƒ«ãƒ¼ã§ã®å³è…•ã®ä¼¸ã³ãŒã‚‚ã†å°‘ã—æ¬²ã—ã„ã¨ã“ã‚ã§ã™ã€‚åŠªåŠ›ã¨å‘ä¸Šå¿ƒãŒæ„Ÿã˜ã‚‰ã‚Œã‚‹ã‚¹ã‚¤ãƒ³ã‚°ã§ã™ã€‚\n\nã€Goodã€‘ç¶™ç¶šçš„ãªæ”¹å–„ã¸ã®æ„æ¬²ãŒã‚¹ã‚¤ãƒ³ã‚°ã«ç¾ã‚Œã¦ã„ã¾ã™ã€‚\nã€Nextã€‘è…°ã®å›è»¢ã‚’ã‚‚ã†å°‘ã—æ„è­˜ã™ã‚‹ã¨ã€ã‚ˆã‚ŠåŠ›å¼·ã„ã‚¹ã‚¤ãƒ³ã‚°ã«ãªã‚‹ã§ã—ã‚‡ã†ã€‚',
      'ã€æŠ€è¡“åˆ†æã€‘ã‚¢ãƒ‰ãƒ¬ã‚¹æ™‚ã®å§¿å‹¢ã¯æ¦‚ã­è‰¯å¥½ã§ã™ãŒã€ä½“é‡é…åˆ†ãŒè‹¥å¹²å¾Œã‚å¯„ã‚Šã§ã™ã€‚ãƒãƒƒã‚¯ã‚¹ã‚¤ãƒ³ã‚°æ™‚ã®ã‚¯ãƒ©ãƒ–ãƒ˜ãƒƒãƒ‰ã®è»Œé“ã¯å®‰å®šã—ã¦ã„ã¾ã™ãŒã€ãƒˆãƒƒãƒ—ã§ã®æ‰‹é¦–ã®è§’åº¦ã«æ³¨æ„ãŒå¿…è¦ã§ã™ã€‚ãƒ€ã‚¦ãƒ³ã‚¹ã‚¤ãƒ³ã‚°æ™‚ã®ä½“ã®ä½¿ã„æ–¹ã«ã¯æ”¹å–„ã®ä½™åœ°ãŒã‚ã‚Šã¾ã™ãŒã€åŸºæœ¬çš„ãªå‹•ãã¯èº«ã«ã¤ã„ã¦ã„ã¾ã™ã€‚\n\nã€Goodã€‘åŸºç¤ã‚’å¤§åˆ‡ã«ã™ã‚‹å§¿å‹¢ãŒè©•ä¾¡ã§ãã¾ã™ã€‚\nã€Nextã€‘ã‚¢ãƒ‰ãƒ¬ã‚¹æ™‚ã®ä½“é‡é…åˆ†ã‚’è¦‹ç›´ã™ã¨ã€ã‚ˆã‚Šå®‰å®šã—ãŸã‚¹ã‚¤ãƒ³ã‚°ã«ãªã‚Šã¾ã™ã€‚'
    ]
  },
  {
    scoreRange: [0, 59],
    comments: [
      'ã€æŠ€è¡“åˆ†æã€‘ã‚¢ãƒ‰ãƒ¬ã‚¹æ™‚ã®å§¿å‹¢ã«åŸºæœ¬çš„ãªèª²é¡ŒãŒè¦‹ã‚‰ã‚Œã¾ã™ãŒã€ã‚¹ã‚¤ãƒ³ã‚°ã«å¯¾ã™ã‚‹æ„æ¬²ã¯ååˆ†ã«æ„Ÿã˜ã‚‰ã‚Œã¾ã™ã€‚ãƒãƒƒã‚¯ã‚¹ã‚¤ãƒ³ã‚°æ™‚ã®è»Œé“ã¯æ”¹å–„ã®ä½™åœ°ãŒã‚ã‚Šã¾ã™ãŒã€ã‚¤ãƒ³ãƒ‘ã‚¯ãƒˆã«å‘ã‹ã†æ°—æŒã¡ã®å¼·ã•ã¯è©•ä¾¡ã§ãã¾ã™ã€‚ãƒ•ã‚©ãƒ­ãƒ¼ã‚¹ãƒ«ãƒ¼ã§ã®ä½“ã®ä½¿ã„æ–¹ã‚’è¦šãˆã‚‹ã¨ã€å¤§å¹…ãªå‘ä¸ŠãŒæœŸå¾…ã§ãã‚‹ã§ã—ã‚‡ã†ã€‚\n\nã€Goodã€‘æŒ‘æˆ¦ã‚’ç¶šã‘ã‚‹å§¿å‹¢ã¯çµŒå–¶è€…ã®é‘‘ã§ã™ã€‚\nã€Nextã€‘åŸºæœ¬çš„ãªã‚¢ãƒ‰ãƒ¬ã‚¹ã‹ã‚‰è¦‹ç›´ã™ã“ã¨ã§ã€é£›èºçš„ãªæ”¹å–„ãŒè¦‹è¾¼ã‚ã¾ã™ã€‚',
      'ã€æŠ€è¡“åˆ†æã€‘ã‚°ãƒªãƒƒãƒ—ã‚„æ§‹ãˆæ–¹ã«æ”¹å–„ç‚¹ã¯ã‚ã‚Šã¾ã™ãŒã€ã‚¹ã‚¤ãƒ³ã‚°ã¸ã®å–ã‚Šçµ„ã¿å§¿å‹¢ã¯ç´ æ™´ã‚‰ã—ã„ã§ã™ã€‚ãƒãƒƒã‚¯ã‚¹ã‚¤ãƒ³ã‚°æ™‚ã®ä½“ã®å‹•ãã‚’æ•´ç†ã—ã€åŸºæœ¬çš„ãªå‹•ä½œã‚’èº«ã«ã¤ã‘ã‚‹ã“ã¨ã§ã€ã‚ˆã‚Šè‰¯ã„ã‚¹ã‚¤ãƒ³ã‚°ã«ç™ºå±•ã•ã›ã‚‹ã“ã¨ãŒã§ãã‚‹ã§ã—ã‚‡ã†ã€‚ç¶™ç¶šçš„ãªç·´ç¿’ã®æˆæœãŒå°‘ã—ãšã¤ç¾ã‚Œã¦ã„ã¾ã™ã€‚\n\nã€Goodã€‘å›°é›£ã«å±ˆã—ãªã„å¼·ã„æ„å¿—ãŒã‚¹ã‚¤ãƒ³ã‚°ã‹ã‚‰ã‚‚ä¼ã‚ã£ã¦ãã¾ã™ã€‚\nã€Nextã€‘åŸºæœ¬å‹•ä½œã®åå¾©ç·´ç¿’ã«ã‚ˆã‚Šã€ç¢ºå®Ÿã«ãƒ¬ãƒ™ãƒ«ã‚¢ãƒƒãƒ—ã§ãã‚‹ã§ã—ã‚‡ã†ã€‚',
      'ã€æŠ€è¡“åˆ†æã€‘ç¾åœ¨ã®ã‚¹ã‚¤ãƒ³ã‚°ã«ã¯èª²é¡ŒãŒã‚ã‚Šã¾ã™ãŒã€æ”¹å–„ã¸ã®æ„æ¬²ã¨å¯èƒ½æ€§ã‚’å¼·ãæ„Ÿã˜ã¾ã™ã€‚æ­£ã—ã„ãƒ•ã‚©ãƒ¼ãƒ ã‚’èº«ã«ã¤ã‘ã‚‹ã“ã¨ã§ã€åŠ‡çš„ãªå¤‰åŒ–ãŒæœŸå¾…ã§ãã¾ã™ã€‚ã¾ãšã¯åŸºæœ¬çš„ãªã‚°ãƒªãƒƒãƒ—ã¨ã‚¢ãƒ‰ãƒ¬ã‚¹ã‹ã‚‰å§‹ã‚ã¦ã€ä¸€æ­©ãšã¤ç©ã¿ä¸Šã’ã¦ã„ãã“ã¨ãŒé‡è¦ã§ã™ã€‚\n\nã€Goodã€‘å‘ä¸Šå¿ƒã¨åŠªåŠ›ã‚’ç¶šã‘ã‚‹å§¿å‹¢ã¯çœŸã®ãƒªãƒ¼ãƒ€ãƒ¼ã‚·ãƒƒãƒ—ã§ã™ã€‚\nã€Nextã€‘ãƒ—ãƒ­ã®æŒ‡å°ã‚’å—ã‘ãªãŒã‚‰ã€åŸºç¤ã‹ã‚‰ä¸å¯§ã«æ§‹ç¯‰ã—ã¦ã„ãã¾ã—ã‚‡ã†ã€‚'
    ]
  }
]

// ãƒ¡ã‚¤ãƒ³åˆ†æé–¢æ•°
export async function analyzeSwing(videoData) {
  debugUtils.log('Starting swing analysis', { fileName: videoData.fileName })
  
  try {
    // åˆ†æã®é€²è¡ŒçŠ¶æ³ã‚’æ®µéšçš„ã«æ›´æ–°
    await simulateAnalysisProgress()
    
    // ã‚¹ã‚³ã‚¢ç”Ÿæˆ
    const scores = generateScores(videoData)
    const totalScore = calculateTotalScore(scores)
    const bonusRate = scoreUtils.calculateBonusRate(totalScore)
    const comment = generateAnalysisComment(totalScore)
    
    // çµæœã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆä½œæˆ
    const result = {
      year: videoData.year,
      totalScore,
      scores,
      bonusRate,
      comment,
      analysisDate: new Date().toISOString(),
      videoInfo: {
        fileName: videoData.fileName,
        duration: videoData.duration,
        fileSize: videoData.fileSize
      }
    }
    
    debugUtils.log('Analysis completed', result)
    return result
    
  } catch (error) {
    debugUtils.error('Analysis failed', error)
    throw new Error('ã‚¹ã‚¤ãƒ³ã‚°åˆ†æä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ')
  }
}

// ã‚¹ã‚³ã‚¢ç”Ÿæˆï¼ˆãƒ¢ãƒƒã‚¯å®Ÿè£…ï¼‰
function generateScores(videoData) {
  const scores = {}
  
  // ãƒ™ãƒ¼ã‚¹ã‚¹ã‚³ã‚¢ï¼ˆ65-85ç‚¹ã®ç¯„å›²ï¼‰
  const baseScore = 65 + Math.random() * 20
  
  // å„é …ç›®ã®ã‚¹ã‚³ã‚¢ç”Ÿæˆ
  Object.keys(SCORING_ITEMS).forEach(key => {
    let itemScore = baseScore
    
    // ãƒ•ã‚¡ã‚¤ãƒ«ç‰¹å¾´ã«åŸºã¥ãèª¿æ•´
    if (key === 'power') {
      // ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºãŒå¤§ãã„ã»ã©åŠ›å¼·ã•ãŒé«˜ã„ï¼ˆä»®ï¼‰
      const sizeBonus = Math.min(10, videoData.fileSize / (10 * 1024 * 1024))
      itemScore += sizeBonus - 5
    }
    
    if (key === 'stability') {
      // å‹•ç”»æ™‚é–“ãŒé©åˆ‡ï¼ˆ10-30ç§’ï¼‰ãªã‚‰å®‰å®šæ€§ãŒé«˜ã„
      const duration = videoData.duration || 15
      if (duration >= 10 && duration <= 30) {
        itemScore += 5
      } else {
        itemScore -= 3
      }
    }
    
    if (key === 'beauty') {
      // ãƒ©ãƒ³ãƒ€ãƒ è¦ç´ ï¼ˆç¾ã—ã•ã¯ä¸»è¦³çš„ï¼‰
      itemScore += Math.random() * 10 - 5
    }
    
    if (key === 'growth') {
      // éå»ã®ã‚¹ã‚³ã‚¢ã¨æ¯”è¼ƒï¼ˆå±¥æ­´ãŒã‚ã‚‹å ´åˆï¼‰
      const history = window.swingApp.history
      if (history.length > 0) {
        const lastScore = history[history.length - 1].totalScore
        const improvement = Math.random() * 10 - 2 // åŸºæœ¬çš„ã«ã¯æˆé•·å‚¾å‘
        itemScore = Math.max(lastScore + improvement, itemScore)
      }
    }
    
    if (key === 'spirit') {
      // æ™‚åˆ»ã«åŸºã¥ãèª¿æ•´ï¼ˆæœãªã‚‰æ°—åˆååˆ†ã€å¤œãªã‚‰ç–²åŠ´æ°—å‘³ï¼‰
      const hour = new Date().getHours()
      if (hour >= 9 && hour <= 11) {
        itemScore += 3 // æœã®æ°—åˆ
      } else if (hour >= 22 || hour <= 6) {
        itemScore -= 2 // å¤œã®ç–²åŠ´
      }
    }
    
    // ãƒ©ãƒ³ãƒ€ãƒ è¦ç´ ã‚’è¿½åŠ 
    itemScore += Math.random() * 8 - 4
    
    // 0-100ã®ç¯„å›²ã«åã‚ã‚‹
    scores[key] = Math.max(0, Math.min(100, Math.round(itemScore)))
  })
  
  return scores
}

// ç·åˆã‚¹ã‚³ã‚¢è¨ˆç®—
function calculateTotalScore(scores) {
  let totalScore = 0
  let totalWeight = 0
  
  Object.keys(SCORING_ITEMS).forEach(key => {
    const weight = SCORING_ITEMS[key].weight
    totalScore += scores[key] * weight
    totalWeight += weight
  })
  
  return Math.round(totalScore / totalWeight)
}

// åˆ†æã‚³ãƒ¡ãƒ³ãƒˆç”Ÿæˆ
function generateAnalysisComment(totalScore) {
  const commentGroup = ANALYSIS_COMMENTS.find(group => 
    totalScore >= group.scoreRange[0] && totalScore <= group.scoreRange[1]
  )
  
  if (commentGroup) {
    const randomIndex = Math.floor(Math.random() * commentGroup.comments.length)
    return commentGroup.comments[randomIndex]
  }
  
  return 'ã‚¹ã‚¤ãƒ³ã‚°åˆ†æãŒå®Œäº†ã—ã¾ã—ãŸã€‚ç¶™ç¶šçš„ãªæ”¹å–„ã‚’ç›®æŒ‡ã—ã¾ã—ã‚‡ã†ã€‚'
}

// åˆ†æé€²è¡ŒçŠ¶æ³ã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆ
async function simulateAnalysisProgress() {
  const steps = [
    { message: 'å‹•ç”»ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿ä¸­...', duration: 800 },
    { message: 'ã‚¹ã‚¤ãƒ³ã‚°ãƒ•ã‚©ãƒ¼ãƒ ã‚’è§£æä¸­...', duration: 1200 },
    { message: 'å„é …ç›®ã‚¹ã‚³ã‚¢ã‚’ç®—å‡ºä¸­...', duration: 1000 },
    { message: 'ç·åˆè©•ä¾¡ã‚’ç”Ÿæˆä¸­...', duration: 600 }
  ]
  
  for (const step of steps) {
    // ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹æ›´æ–°ã‚¤ãƒ™ãƒ³ãƒˆã‚’ç™ºç«
    window.dispatchEvent(new CustomEvent('analysisProgress', {
      detail: { message: step.message }
    }))
    
    // æŒ‡å®šæ™‚é–“å¾…æ©Ÿ
    await new Promise(resolve => setTimeout(resolve, step.duration))
  }
}

// ã‚¹ã‚³ã‚¢è©³ç´°æƒ…å ±ã‚’å–å¾—
export function getScoreDetails(scores) {
  return Object.keys(SCORING_ITEMS).map(key => ({
    key,
    name: SCORING_ITEMS[key].name,
    icon: SCORING_ITEMS[key].icon,
    weight: SCORING_ITEMS[key].weight,
    score: scores[key],
    grade: scoreUtils.getScoreGrade(scores[key])
  }))
}

// éå»ã¨ã®æ¯”è¼ƒãƒ‡ãƒ¼ã‚¿ç”Ÿæˆ
export function generateComparisonData(currentScore, history) {
  if (history.length === 0) {
    return {
      isFirstTime: true,
      message: 'åˆå›ã®ã‚¹ã‚¤ãƒ³ã‚°è¨˜éŒ²ã§ã™ï¼'
    }
  }
  
  const lastScore = history[history.length - 1].totalScore
  const difference = currentScore - lastScore
  
  let message = ''
  let trend = 'stable'
  
  if (difference > 5) {
    message = `æ˜¨å¹´ã‚ˆã‚Š${difference}ç‚¹å‘ä¸Šã—ã¾ã—ãŸï¼ç´ æ™´ã‚‰ã—ã„æˆé•·ã§ã™ï¼`
    trend = 'up'
  } else if (difference < -5) {
    message = `æ˜¨å¹´ã‚ˆã‚Š${Math.abs(difference)}ç‚¹ä¸‹ãŒã‚Šã¾ã—ãŸãŒã€æ¥å¹´ã®å·»ãè¿”ã—ã«æœŸå¾…ï¼`
    trend = 'down'
  } else {
    message = 'æ˜¨å¹´ã¨åŒæ°´æº–ã®å®‰å®šã—ãŸã‚¹ã‚¤ãƒ³ã‚°ã§ã™ã€‚'
    trend = 'stable'
  }
  
  return {
    isFirstTime: false,
    lastScore,
    currentScore,
    difference,
    message,
    trend
  }
}

// ãƒœãƒ¼ãƒŠã‚¹è¨ˆç®—è©³ç´°
export function calculateBonusDetails(totalScore, baseAmount = 100000) {
  const bonusRate = scoreUtils.calculateBonusRate(totalScore)
  const bonusAmount = Math.round(baseAmount * bonusRate / 100)
  const totalAmount = baseAmount + bonusAmount
  
  return {
    baseAmount,
    bonusRate,
    bonusAmount,
    totalAmount,
    formattedTotal: new Intl.NumberFormat('ja-JP', {
      style: 'currency',
      currency: 'JPY'
    }).format(totalAmount)
  }
}